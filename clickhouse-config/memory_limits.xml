<?xml version="1.0"?>
<clickhouse>
    <!-- 内存限制配置 - 适用于低内存服务器 -->
    <!-- 降低内存限制，适配 2.4GB 总内存的服务器 -->
    <max_server_memory_usage>1073741824</max_server_memory_usage>  <!-- 1GB -->
    <max_server_memory_usage_to_ram_ratio>0.45</max_server_memory_usage_to_ram_ratio>
    <mark_cache_size>52428800</mark_cache_size>  <!-- 50MB -->
    <uncompressed_cache_size>0</uncompressed_cache_size>
    
    <profiles>
        <default>
            <!-- 单个查询最大内存：512MB -->
            <max_memory_usage>536870912</max_memory_usage>
            <!-- 内存超限时溢出到磁盘 -->
            <max_bytes_before_external_group_by>209715200</max_bytes_before_external_group_by>  <!-- 200MB -->
            <max_bytes_before_external_sort>209715200</max_bytes_before_external_sort>
            <!-- 限制并发查询数 -->
            <max_concurrent_queries>2</max_concurrent_queries>
        </default>
    </profiles>
</clickhouse>
