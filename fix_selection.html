<!DOCTYPE html>
<html>
<head>
    <title>é€‰è‚¡ç»“æœæŸ¥çœ‹å™¨</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #0f172a; color: #e5e7eb; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { margin-bottom: 20px; }
        .stock-item { 
            background: #1e293b; 
            margin: 8px 0; 
            padding: 12px; 
            border-radius: 6px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        .stock-code { font-weight: bold; color: #60a5fa; }
        .stock-name { color: #94a3b8; }
        .stock-price { color: #10b981; font-weight: bold; }
        .btn { 
            background: #3b82f6; 
            color: white; 
            border: none; 
            padding: 8px 16px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 0 5px;
        }
        .btn:hover { background: #2563eb; }
        .status { margin: 10px 0; padding: 10px; background: #1e293b; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ˆ é€‰è‚¡ç»“æœæŸ¥çœ‹å™¨ <span style="color: #10b981; font-size: 14px;">âš¡ å·²ä¼˜åŒ–</span></h1>
            <button class="btn" onclick="loadResults()">ğŸ”„ åŠ è½½æœ€æ–°ç»“æœ</button>
            <button class="btn" onclick="startNewSelection()">ğŸ¯ å¼€å§‹æ–°é€‰è‚¡ <small>(2-5ç§’)</small></button>
        </div>
        <div id="status" class="status">ç‚¹å‡»"åŠ è½½æœ€æ–°ç»“æœ"æŸ¥çœ‹é€‰è‚¡æ•°æ®</div>
        <div id="results"></div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        
        async function loadResults() {
            const statusEl = document.getElementById('status');
            const resultsEl = document.getElementById('results');
            
            statusEl.textContent = 'æ­£åœ¨åŠ è½½é€‰è‚¡ç»“æœ...';
            
            try {
                const response = await fetch(`${API_BASE}/api/strategy/selected`);
                const result = await response.json();
                
                if (result.code === 0) {
                    const data = result.data;
                    const stocks = data.stocks || [];
                    
                    statusEl.innerHTML = `
                        <strong>é€‰è‚¡ç»“æœ</strong><br>
                        å¸‚åœº: ${data.market || 'N/A'} | 
                        æ•°é‡: ${data.count || 0} | 
                        æ—¶é—´: ${data.timestamp ? new Date(data.timestamp).toLocaleString() : 'N/A'}
                    `;
                    
                    if (stocks.length > 0) {
                        resultsEl.innerHTML = stocks.map((stock, index) => `
                            <div class="stock-item">
                                <div>
                                    <span class="stock-code">${stock.code || 'N/A'}</span>
                                    <span class="stock-name">${stock.name || stock.code || 'N/A'}</span>
                                </div>
                                <div>
                                    <span class="stock-price">Â¥${stock.price || 'N/A'}</span>
                                    <span style="margin-left: 10px; color: ${(stock.pct || 0) >= 0 ? '#10b981' : '#ef4444'}">
                                        ${stock.pct ? (stock.pct > 0 ? '+' : '') + stock.pct.toFixed(2) + '%' : 'N/A'}
                                    </span>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        resultsEl.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 40px;">æš‚æ— é€‰è‚¡ç»“æœ</div>';
                    }
                } else {
                    statusEl.textContent = `åŠ è½½å¤±è´¥: ${result.message || 'æœªçŸ¥é”™è¯¯'}`;
                    resultsEl.innerHTML = '';
                }
            } catch (error) {
                statusEl.textContent = `ç½‘ç»œé”™è¯¯: ${error.message}`;
                resultsEl.innerHTML = '';
            }
        }
        
        async function startNewSelection() {
            const statusEl = document.getElementById('status');
            const resultsEl = document.getElementById('results');
            
            statusEl.innerHTML = 'æ­£åœ¨å¯åŠ¨æ–°çš„é€‰è‚¡ä»»åŠ¡...<br><small>ä¼˜åŒ–åé¢„è®¡è€—æ—¶: 2-5ç§’</small>';
            resultsEl.innerHTML = '';
            
            const startTime = Date.now();
            
            try {
                const taskId = `selection_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                const response = await fetch(`${API_BASE}/api/strategy/select?max_count=30&market=A&task_id=${taskId}`);
                const result = await response.json();
                
                const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                
                if (result.code === 0) {
                    statusEl.innerHTML = `
                        <strong>ğŸ‰ é€‰è‚¡å®Œæˆï¼</strong><br>
                        æ‰¾åˆ° ${result.data.length} åªè‚¡ç¥¨ï¼Œè€—æ—¶: ${elapsed}ç§’<br>
                        <small>ä»»åŠ¡ID: ${result.task_id || taskId}</small>
                    `;
                    
                    if (result.data.length > 0) {
                        resultsEl.innerHTML = result.data.map((stock, index) => `
                            <div class="stock-item">
                                <div>
                                    <span class="stock-code">${stock.code || 'N/A'}</span>
                                    <span class="stock-name">${stock.name || stock.code || 'N/A'}</span>
                                </div>
                                <div>
                                    <span class="stock-price">Â¥${stock.price || 'N/A'}</span>
                                    <span style="margin-left: 10px; color: ${(stock.pct || 0) >= 0 ? '#10b981' : '#ef4444'}">
                                        ${stock.pct ? (stock.pct > 0 ? '+' : '') + stock.pct.toFixed(2) + '%' : 'N/A'}
                                    </span>
                                </div>
                            </div>
                        `).join('');
                    }
                } else {
                    statusEl.innerHTML = `
                        <strong>âŒ é€‰è‚¡å¤±è´¥</strong><br>
                        ${result.message || 'æœªçŸ¥é”™è¯¯'}ï¼Œè€—æ—¶: ${elapsed}ç§’
                    `;
                }
            } catch (error) {
                const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                statusEl.innerHTML = `
                    <strong>ğŸ”¥ ç½‘ç»œé”™è¯¯</strong><br>
                    ${error.message}ï¼Œè€—æ—¶: ${elapsed}ç§’
                `;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½ç»“æœ
        window.addEventListener('load', loadResults);
    </script>
</body>
</html>